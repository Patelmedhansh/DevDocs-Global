name: ğŸŒ Auto Translate Documentation

on:
  push:
    paths:
      - 'docs/**'
      - '.github/workflows/auto-translate.yml'
  workflow_dispatch:

env:
  LINGO_API_KEY: ${{ secrets.LINGO_API_KEY }}

jobs:
  translate:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout code
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # Step 2: Setup Node.js
      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      # Step 3: Install dependencies
      - name: ğŸ“¦ Install dependencies
        run: npm ci

      # Step 4: Run CLI translate command
      - name: ğŸ¤– Translate documentation
        run: npx devdocs-global translate --incremental
        env:
          LINGO_API_KEY: ${{ secrets.LINGO_API_KEY }}

      # Step 5: Check for changes
      - name: ğŸ“ Check if translations changed
        id: verify
        run: |
          if git diff --quiet; then
            echo "No changes detected"
            echo "has_changes=false" >> $GITHUB_OUTPUT
          else
            echo "Changes detected"
            echo "has_changes=true" >> $GITHUB_OUTPUT
            git diff --name-only
          fi

      # Step 6: Commit translations
      - name: ğŸ’¾ Commit translations
        if: steps.verify.outputs.has_changes == 'true'
        run: |
          git config --local user.email "devdocs-bot@github.com"
          git config --local user.name "DevDocs Global Bot"
          git add docs/
          git commit -m "ğŸŒ Auto-translate: Updated documentation for 6 languages

          - Source: English documentation
          - Targets: Spanish, French, German, Japanese, Hindi, Chinese
          - Timestamp: $(date -u +'%Y-%m-%d %H:%M:%S UTC')
          - Powered by Lingo AI + GPT-4"

      # Step 7: Push changes
      - name: ğŸš€ Push translations
        if: steps.verify.outputs.has_changes == 'true'
        run: git push

      # Step 8: Create pull request (optional)
      - name: ğŸ“‹ Create Pull Request
        if: steps.verify.outputs.has_changes == 'true'
        uses: peter-evans/create-pull-request@v4
        with:
          commit-message: 'ğŸŒ Auto-translate documentation'
          title: 'ğŸŒ Auto-translated: Updated multilingual documentation'
          body: |
            ## ğŸ¤– Automated Translation Update

            This PR contains automatically generated translations using:
            - **AI Model:** GPT-4 Turbo
            - **Provider:** Lingo API
            - **Languages:** 6 target languages

            ### Translation Details
            - Source: English (docs/en/)
            - Updated: \`$(date -u +'%Y-%m-%d %H:%M:%S UTC')\`
            - Files Changed: Check commit details

            ### Quality Assurance
            Please review the translations before merging.

            ---
            *Generated by DevDocs Global GitHub Actions Workflow*
          branch: auto-translate/update-docs

      # Step 9: Generate statistics
      - name: ğŸ“Š Generate statistics
        if: always()
        run: |
          echo "## Translation Statistics"
          echo "Docs translated at: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
          echo "Total files processed: $(find docs -name '*.md' | wc -l)"
          echo "Workflow status: ${{ job.status }}"

      # Step 10: Notify on failure
      - name: ğŸš¨ Notify failure
        if: failure()
        run: |
          echo "âŒ Translation workflow failed!"
          echo "Check logs for details"
